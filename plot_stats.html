<!DOCTYPE html>
<html>
<head>
    <title>ID Generator Performance Comparison</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .selector-container {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .selector {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            color: #666;
        }
        .selector-active {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        #select-all-systems {
            font-weight: bold;
            margin-right: 10px;
        }
        #loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            padding: 20px;
            text-align: center;
            border: 1px solid #f5c6cb;
            background-color: #f8d7da;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .size-cell {
            font-family: monospace;
        }
        .ratio-good {
            background-color: rgb(232, 255, 232);
        }
        .ratio-15-2 {
            background-color: rgb(255, 220, 220);
        }
        .ratio-2-3 {
            background-color: rgb(255, 200, 200);
        }
        .ratio-above-3 {
            background-color: rgb(255, 180, 180);
        }
        .controls {
            margin: 20px 0;
        }
        .control-group {
            margin-bottom: 10px;
        }
        .control-group label {
            font-weight: bold;
            margin-right: 10px;
        }
        select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ID Generator Performance Comparison</h1>
    
    <div id="loading">Loading data...</div>
    <div id="error" class="error"></div>

    <div class="selector-container" style="display: none;">
        <table class="selector-table">
            <tr>
                <th>ID Types: </th>
                <td id="selectors_system">
                    <a id="select-all-systems" class="selector selector-active">All</a>
                </td>
            </tr>
        </table>
    </div>

    <div class="controls">
        <div class="control-group">
            <label for="scale-select">Scale:</label>
            <select id="scale-select">
                <option value="1000">1,000 rows</option>
                <option value="10000">10,000 rows</option>
                <option value="100000">100,000 rows</option>
            </select>
        </div>
    </div>

    <table id="comparison-table" style="display: none;">
        <thead>
            <tr>
                <th>ID Type</th>
                <th>Total Table Size</th>
                <th>Data Size</th>
                <th>Index Size</th>
                <th>Duration (ms)</th>
            </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
    </table>

    <script>
        let idTypes = [];
        let data = null;
        
        function formatBytes(bytes) {
            const sizes = ['B', 'KiB', 'MiB', 'GiB'];
            if (bytes === 0) return '0 B';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;
        }

        function colorize(ratio) {
            if (ratio <= 1.5) return 'ratio-good';
            if (ratio <= 2.0) return 'ratio-15-2';
            if (ratio <= 3.0) return 'ratio-2-3';
            return 'ratio-above-3';
        }

        function updateTable() {
            const tableBody = document.getElementById('table-body');
            const selectedCount = document.getElementById('scale-select').value;
            const activeSelectors = document.querySelectorAll('.selector-active[data-name]');
            const selectedTypes = Array.from(activeSelectors).map(el => el.dataset.name);
            
            // Clear the table
            tableBody.innerHTML = '';
            
            // Filter data for selected types
            const filteredData = {};
            selectedTypes.forEach(type => {
                if (data.Data[type]) {
                    filteredData[type] = data.Data[type].find(s => s.count === parseInt(selectedCount));
                }
            });

            // Find minimum sizes for the selected data
            const minTotalSize = Math.min(...Object.values(filteredData).map(s => parseInt(s.total_table_size)));
            const minDataSize = Math.min(...Object.values(filteredData).map(s => parseInt(s.data_size)));
            const minIndexSize = Math.min(...Object.values(filteredData).map(s => parseInt(s.index_size)));
            const minDuration = Math.min(...Object.values(filteredData).map(s => s.duration));

            // Add rows for each selected ID type
            selectedTypes.forEach(idType => {
                const stats = filteredData[idType];
                if (!stats) return;

                const row = document.createElement('tr');
                
                const totalRatio = parseInt(stats.total_table_size) / minTotalSize;
                const dataRatio = parseInt(stats.data_size) / minDataSize;
                const indexRatio = parseInt(stats.index_size) / minIndexSize;
                const durationRatio = stats.duration / minDuration;

                row.innerHTML = `
                    <td>${idType}</td>
                    <td class="size-cell ${colorize(totalRatio)}">${formatBytes(parseInt(stats.total_table_size))} (&times;${totalRatio.toFixed(2)})</td>
                    <td class="size-cell ${colorize(dataRatio)}">${formatBytes(parseInt(stats.data_size))} (&times;${dataRatio.toFixed(2)})</td>
                    <td class="size-cell ${colorize(indexRatio)}">${formatBytes(parseInt(stats.index_size))} (&times;${indexRatio.toFixed(2)})</td>
                    <td class="size-cell ${colorize(durationRatio)}">${stats.duration.toFixed(2)} (&times;${durationRatio.toFixed(2)})</td>
                `;
                tableBody.appendChild(row);
            });

            document.getElementById('comparison-table').style.display = 'table';
        }

        function initializeSelectors() {
            const container = document.getElementById('selectors_system');
            idTypes.forEach(idType => {
                const selector = document.createElement('a');
                selector.className = 'selector selector-active';
                selector.dataset.name = idType;
                selector.textContent = idType;
                selector.addEventListener('click', function(e) {
                    e.preventDefault();
                    this.classList.toggle('selector-active');
                    updateTable();
                });
                container.appendChild(selector);
            });

            document.getElementById('select-all-systems').addEventListener('click', function(e) {
                e.preventDefault();
                const isDeselecting = document.querySelectorAll('.selector-active[data-name]').length === idTypes.length;
                
                document.querySelectorAll('.selector[data-name]').forEach(selector => {
                    if (isDeselecting) {
                        selector.classList.remove('selector-active');
                    } else {
                        selector.classList.add('selector-active');
                    }
                });
                
                this.classList.toggle('selector-active', !isDeselecting);
                updateTable();
            });

            document.querySelector('.selector-container').style.display = 'block';
        }

        // Add scale select event listener
        document.getElementById('scale-select').addEventListener('change', updateTable);

        // Load data from JSON file
        fetch('template_data.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load data');
                }
                return response.json();
            })
            .then(jsonData => {
                data = jsonData;
                idTypes = jsonData.IDTypes;
                document.getElementById('loading').style.display = 'none';
                initializeSelectors();
                updateTable();
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = 'Error loading data: ' + error.message;
                errorDiv.style.display = 'block';
            });
    </script>
</body>
</html> 