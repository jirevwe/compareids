# Compare IDs - Production-Scale ID Performance Testing

A comprehensive tool for comparing different ID generation strategies in production-like environments. This project allows you to test ID performance with datasets ranging from thousands to billions of records using Docker and Docker Compose.

## üöÄ Quick Start

### Prerequisites

- Docker and Docker Compose
- At least 4GB RAM (8GB+ recommended for large tests)
- 10GB+ free disk space (200GB+ for billion-scale tests)

### Running Tests

Choose your test scale and run:

```bash
# Small scale (1K-10K records) - 5-10 minutes
./run-small.sh

# Medium scale (1K-1M records) - 2-4 hours
./run-medium.sh

# Large scale (10K-10M records) - 8-16 hours
./run-large.sh

# Billion scale (1M-1B records) - 24-72 hours
./run-billion.sh
```

## üìä Test Scenarios

### Small Scale (`small`)

- **Records**: 1,000 - 10,000
- **ID Types**: 4 core types (bigserial, uuidv4, ulid, snowflake)
- **Duration**: 5-10 minutes
- **Resources**: 2GB RAM, 2 CPU cores
- **Use Case**: Development, quick validation

### Medium Scale (`medium`)

- **Records**: 1,000 - 1,000,000
- **ID Types**: All 16 supported types
- **Duration**: 2-4 hours
- **Resources**: 8GB RAM, 4 CPU cores
- **Use Case**: Standard performance testing

### Large Scale (`large`)

- **Records**: 10,000 - 10,000,000
- **ID Types**: All 16 supported types
- **Duration**: 8-16 hours
- **Resources**: 16GB RAM, 8 CPU cores
- **Use Case**: Production-like testing

### Billion Scale (`billion`)

- **Records**: 1,000,000 - 1,000,000,000
- **ID Types**: 6 core types (bigserial, snowflake, uuidv4, uuidv7, ulid, xid)
- **Duration**: 24-72 hours
- **Resources**: 32GB+ RAM, 16+ CPU cores
- **Use Case**: Extreme scale testing

## üõ†Ô∏è Advanced Usage

### Custom Configuration

Create your own test configuration:

```bash
# Copy an existing environment file
cp env.medium my-custom.env

# Edit the configuration
nano my-custom.env

# Run with custom configuration
cp my-custom.env .env
docker compose up --build
```

### Environment Variables

Key configuration options:

```bash
# Test configuration
TEST_SCENARIO=medium          # Test scenario to run
MAX_ROWS=1000000             # Maximum rows per test
PARALLEL_TESTS=1             # Number of parallel tests

# Resource limits
MEMORY_LIMIT=8G              # Memory limit for test container
CPU_LIMIT=4                  # CPU limit for test container
POSTGRES_MEMORY_LIMIT=4G     # Memory limit for PostgreSQL
POSTGRES_CPU_LIMIT=2         # CPU limit for PostgreSQL

# Database configuration
POSTGRES_PORT=5432           # PostgreSQL port
```

### Monitoring

Run tests with monitoring enabled:

```bash
# Run with Prometheus monitoring
./run-with-monitoring.sh medium

# Access monitoring at http://localhost:9090
```

### Manual Docker Compose

```bash
# Build and run with specific environment
docker compose --env-file env.large up --build

# Run in background
docker compose up -d

# View logs
docker compose logs -f ids

# Stop and cleanup
docker compose down -v
```

## üìà Supported ID Types

| ID Type         | Description                                      | Storage Type |
| --------------- | ------------------------------------------------ | ------------ |
| `bigserial`     | PostgreSQL auto-increment                        | BIGINT       |
| `snowflake`     | Twitter Snowflake                                | BIGINT       |
| `uuidv4`        | UUID version 4                                   | UUID         |
| `uuidv4-db`     | UUID v4 generated by DB                          | UUID         |
| `uuidv7`        | UUID version 7                                   | UUID         |
| `uuidv7-db`     | UUID v7 generated by DB                          | UUID         |
| `uuidv7-google` | Google's UUID v7                                 | UUID         |
| `ulid`          | Universally Unique Lexicographically Sortable ID | VARCHAR(26)  |
| `ulid-db`       | ULID generated by DB                             | VARCHAR(26)  |
| `ulid-pg`       | PostgreSQL ULID extension                        | ULID         |
| `xid`           | XID (eXtended ID)                                | VARCHAR(20)  |
| `cuid`          | Collision-resistant Unique ID                    | VARCHAR(25)  |
| `ksuid`         | K-Sortable Unique ID                             | VARCHAR(27)  |
| `nanoid`        | Nano ID                                          | VARCHAR(21)  |
| `typeid`        | TypeID                                           | VARCHAR(27)  |
| `mongoid`       | MongoDB ObjectID                                 | VARCHAR(24)  |

## üìä Results

Test results are saved in the `./results/` directory:

- `data.json` - Merged results from all tests
- Individual JSON files for each ID type and row count
- System metrics and performance data

### Understanding Results

Each test result includes:

- **Duration**: Time taken to insert records (milliseconds)
- **Data Size**: Size of the data in bytes
- **Index Size**: Size of the index in bytes
- **Index Density**: Index efficiency percentage
- **Index Fragmentation**: Index fragmentation percentage
- **System Metrics**: CPU and memory usage during tests

## üîß Development

### Local Development

```bash
# Run locally without Docker
go run cmd/main.go list
go run cmd/main.go id uuidv4 --count 1000
go run cmd/main.go all
```

### Building

```bash
# Build the application
go build -o compareids ./cmd

# Run tests
go test ./...
```

## üèóÔ∏è Architecture

```
‚îú‚îÄ‚îÄ cmd/                    # Application commands
‚îú‚îÄ‚îÄ ids/                    # ID generator implementations
‚îú‚îÄ‚îÄ config/                 # Test configuration files
‚îú‚îÄ‚îÄ monitoring/             # Monitoring configuration
‚îú‚îÄ‚îÄ results/                # Test results (generated)
‚îú‚îÄ‚îÄ sql/                    # Database initialization scripts
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose configuration
‚îú‚îÄ‚îÄ Dockerfile             # Application container
‚îú‚îÄ‚îÄ run.sh                 # Main test execution script
‚îî‚îÄ‚îÄ run-*.sh               # Convenience scripts for different scales
```

## üö® Important Notes

### Resource Requirements

- **Small tests**: Minimum 2GB RAM, 2 CPU cores
- **Medium tests**: Minimum 8GB RAM, 4 CPU cores
- **Large tests**: Minimum 16GB RAM, 8 CPU cores
- **Billion tests**: Minimum 32GB RAM, 16 CPU cores

### Performance Tips

1. **SSD Storage**: Use SSD storage for better I/O performance
2. **Memory**: Ensure sufficient RAM to avoid swapping
3. **CPU**: More CPU cores improve parallel processing
4. **Network**: Use local Docker for best performance
5. **Monitoring**: Monitor system resources during long tests

### Troubleshooting

**Out of Memory Errors**:

```bash
# Increase memory limits in environment file
MEMORY_LIMIT=16G
POSTGRES_MEMORY_LIMIT=8G
```

**Slow Performance**:

```bash
# Check system resources
docker stats

# Monitor PostgreSQL
docker-compose logs postgres
```

**Test Failures**:

```bash
# Check application logs
docker compose logs ids

# Restart with clean state
docker compose down -v
docker compose up --build
```

## üìù Contributing

1. Fork the repository
2. Create a feature branch
3. Add your ID type implementation in `ids/`
4. Update configuration files if needed
5. Test with different scales
6. Submit a pull request

## üìÑ License

This project is open source. See the license file for details.

## ü§ù Support

For issues and questions:

1. Check the troubleshooting section
2. Review existing issues
3. Create a new issue with system details and logs
